Infiniband Flit (Credit) level Simulation for OMNet++
=====================================================

This directory tree hold an InfiniBand model with support for
IB flow control scheme, Arbitration over multiple VLs and routing
based on Linear Forwarding Tables.

This model is derived and significantly enhanced from a [model][1]
originally developed by Mellanox and released under the GPLv2 license.

The most significant enchancement over the original model is support
for trace-based simulation of MPI applications via integration with the
[Dimemas][2] simulator from the Barcelona Supercomputing Center.

For more info regarding each one of the model modules see the [doc](doc)
directory.

## Prerequisites

1. An installation of [OMNet++][https://omnetpp.org] or
[OMNest][https://omnest.com] (commercial version of OMNet++).

2. An installation of Dimemas, configured with the optional Venus
   support enabled:

```
./configure --enable-venus
make
make install
```

## Building the simulation model

1. `make makefiles`
2. `make`

This will make a debug build by default.  To create an optimized build,
add `MODE=release` to the second command like this:

    $ make MODE=release

By default, this will build a shared library which is needed by the
testsuite.  To build an executable instead, you need to rebuild the
makefiles:

    $ make makefiles-exe

## Running the model

You can produce input traces for MPI applications using [Extrae][3].

The utils directory has a script `run_cosimulation.sh` which will run
Dimemas and OMNet++ together in a tmux session.  This script takes two
arguments, the basename of a Paraver trace generated by Extrae, and the
name of a configuration to use.  It looks for a file named
*configuration*`.config.yml`, which contains references to files
containing the following:

1. The output of `ibnetdiscover` for the target network.
2. The output file `ibdiagnet.fdbs` generated by `ibdiagnet` for the
   target network.
3. A CSV file mapping ranks to hosts, using the names assigned by
   `ibnetdiscover` with "invalid" characters mapped to underscores.

You can look in the `dimemas_single_message` example directory for a
small example trace and network configuration.

To run the other example models, cd into the example dir and look for a README.

[1]: https://web.archive.org/web/20130811125321/http://www.mellanox.com/page/omnet
[2]: https://tools.bsc.es/dimemas
[3]: https://tools.bsc.es/extrae
